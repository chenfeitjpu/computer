**系统设计**
- [订单到了半个小时，半个小时未支付就取消](#订单到了半个小时半个小时未支付就取消)

## 订单到了半个小时，半个小时未支付就取消
```
消息队列
- 思路
  下单时发送一条延时消息，到期后检查状态并取消
- 实现
  - rabbitmq 消息TTL+死信队列(DLX)
- 优点
  - 精度高，接近实时
  - 压力均匀，单条订单有自己的定时器
- 缺点
  - 依赖MQ支持延时能力
  - 消息堆积量与订单量成正比，需要容量规划

redis
- 思路
  使用redis做时间轮/延时队列
- 实现
  - 下单时添加超时时间(zset)
  - 后台定时任务扫描超时订单(zrangebyscore)
- 优点
  - 精度可调，时间复杂度较低
  - 全内存结构，扫描快
- 缺点
  - redis挂了需要恢复或重建数据
  - 超大订单量时zset体积要评估

定时任务扫表
- 思路
  DB中保存create_time和status，后台定时任务定期扫超时未支付订单并取消
- 实现
  定时任务每N分钟执行一次
- 优点
  实现简单，无额外中间件依赖
- 缺点
  - 精度取决于任务周期
  - 订单量大时扫描压力大
```