**微服务**
- [定义](#定义)
- [使用](#使用)
  - [微服务的作用](#微服务的作用)
  - [微服务的拆分](#微服务的拆分)
  - [微服务的核心能力](#微服务的核心能力)
    - [服务通信](#服务通信)
    - [服务注册\&服务发现](#服务注册服务发现)
    - [服务治理](#服务治理)
    - [配置中心](#配置中心)
    - [可观测性](#可观测性)

# 定义 #

# 使用 #
## 微服务的作用 ##
```
单体应用的问题
- 模块强耦合  单体越来越大
- 发布不可控  一个功能改动，整体发布
- 资源无法隔离  某个模块慢，拖垮整体
- 技术选型受限  不同模块无法使用不同技术栈
- 代码&数据边界不清  团队协作冲突频繁

微服务解决的问题
边界，解耦，独立演进
- 服务边界清晰（职责单一）
- 独立部署、独立扩缩容
- 服务之间通过网络协议通信
- 故障被限制在局部
```
## 微服务的拆分 ##
```
拆分原则
- 一个服务只做一件完整的事
- 数据是否能私有化
- 是否能独立部署
```

## 微服务的核心能力 ##
### 服务通信 ###
```
http
适用于简单的请求响应模型和对外提供API的场景，易于实现和使用

grpc
适用于需要高性能通信、严格接口定义、多语言环境的场景

消息队列
适用于异步处理和解耦的场景
```

### 服务注册&服务发现 ###
```
服务注册
将提供某个服务的模块信息(通常是这个服务的ip和端口)注册到1个公共的组件上去

服务发现
新注册的这个服务模块能够及时的被其他调用者发现。不管是服务新增和服务删减都能实现自动发现

常用组件
- zookeeper
- etcd
- consul
- nacos
```

### 服务治理 ###
超时
为每个调用设置合适的timeout，避免无限等待

重试
短暂错误时自动重试

限流
- 令牌桶
  桶里按固定速率生成令牌，桶容量有限，每个请求必须拿到一个令牌才能通过，允许合理突发，保护的是资源配额
- 漏桶
  请求先进入桶，桶容量固定，再以固定速度从桶底流出，平滑流量，保护实时处理能力
- 固定窗口
  在一个固定时间段，只允许执行固定数量的请求，突然地挪动窗口
- 滑动窗口
  在一个固定时间段，只允许执行固定数量的请求，平滑地挪动窗口

降级

熔断

### 配置中心 ###
```
常见组件
- etcd 
- nacos
```

### 可观测性 ###
```
log(日志)

metrics(指标)

trace(追踪)
```