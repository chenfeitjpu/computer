**微服务**
- [定义](#定义)
- [使用](#使用)

# 定义 #

# 使用 #
```
服务注册与发现
- 上线流程
  - 服务端启动的时候，需要往注册中心里注册自身的信息
  - 注册成功之后，注册中心和服务端要保持心跳
  - 客户端第一次发起对某个服务的调用之前，要先找注册中心获得所有可用服务节点列表，随后客户端会在本地缓存每个服务对应的可用节点列表
  - 客户端和注册中心要保持心跳和数据同步，后续服务端有任何变动，注册中心都会通知客户端，客户端会更新本地的可用节点列表
  - 客户端发送请求
  - 服务端返回响应
- 下线流程
  - 服务端通知注册中心自己准备下线了
  - 注册中心通知客户端某个服务端下线了
  - 客户端收到通知之后，新来的请求就不会再给该服务端发过去
  - 服务端等待一段时间之后，暂停服务并下线
- 高可用
  - 服务端崩溃检测
    - 当注册中心发现和服务端的心跳失败了，那么它就应该认为服务端可能已经崩溃了，就立刻通知客户端停止使用该服务端
    - 注册中心要继续保持心跳，如果几次心跳都失败了，那么就可以认为服务端已经彻底不可用了。但是如果心跳再次恢复了，那么注册中心就要再次告诉客户端这个服务端是可用的
  - 客户端容错
    - 客户端在发现调不通之后，应该尝试换另外一个节点进行重试
  - 注册中心选型
    - 因素
      - 中间件的成熟度
      - 社区活跃度
      - 性能
    - CAP
      - C  
        数据一致性，所有节点的数据在同一时刻都是相同的
      - A  
        服务可用性，服务宕机不影响整个系统的正常运行
      - P  
        分区容错性，网络故障不影响整个系统的正常运行
      AP 优于 CP

负载均衡
- 算法
  - 静态负载均衡算法
    - 轮询和加权轮询
    - 随机和加权随机
    - 哈希和一致性哈希
  - 动态负载均衡算法
    - 最少连接数
    - 最少活跃数
    - 最快响应时间
  - 动态调整
    根据响应结果调整权重

熔断
整体不可用
- 触发
  - 超过指标阀值
  - 持续一段时间
- 恢复
  - 等待一定时间
  - 逐步放量

降级
有限功能可用
- 分类
  - 跨服务降级
  - 本服务有损降级

限流
- 算法
  - 静态限流算法
    - 令牌桶
      系统会以一个恒定的速率产生令牌，这些令牌会放到一个桶里面，每个请求只有拿到了令牌才会被执行
    - 漏桶
      系统会以一个恒定的速率处理请求
    - 固定窗口
      在一个固定时间段，只允许执行固定数量的请求，突然地挪动窗口
    - 滑动窗口
      在一个固定时间段，只允许执行固定数量的请求，平滑地挪动窗口
- 限流对象
- 后续处理
```