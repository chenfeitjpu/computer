*操作系统*
- [定义#](#定义)
- [内容](#内容)
  - [概念](#概念)
  - [硬件](#硬件)
  - [内存](#内存)
  - [多任务](#多任务)
  - [网络](#网络)
- [应用](#应用)

# 定义#
操作系统是管理计算机硬件与软件资源的计算机程序

# 内容 #
## 概念 ##
```
并发&并行
并发  多个事件交替发生在一个实体上
并行  多个事件同时发生在多个实体上

同步&异步
同步  当一个调用发出后，调用者一直等待返回结果，才能进行后续的执行
异步  当一个调用发出后，调用者不用等待返回结果，处理这个调用的部件在完成后，通过状态、通知和回调来通知调用者

阻塞&非阻塞
阻塞  调用结果返回前，当前线程会被挂起
非阻塞  调用结果返回前，当前线程不会被挂起
```
## 硬件 ##
```
冯诺依曼模型
- 运算器
- 控制器
- 存储器
- 输入设备
- 输出设备

总线
- 地址总线  用于指定CPU将要操作的内存地址
- 数据总线  用于读写内存的数据
- 控制总线  用于发送和接收信号

CPU执行过程
- CPU读取程序计数器的值，将指令数据存入到指令寄存器
- 程序计数器的值自增
- CPU分析指令寄存器中的指令

存储器
- 寄存器
- L1-Cahce(单独, 数据和指令分开)
- L2-Cahce(单独)
- L3-Cahce(共用)
- 内存
- 硬盘

提高CPU缓存命中率
- 提升数据的缓存命中率
  按照内存布局顺序访问
- 提升指令缓存的命中率  
  利用CPU的分支预测器，提前缓存指令
- 提升多核CPU的缓存命中率
  线程绑定在某一个CPU核心上
```

## 内存 ##
```
虚拟内存
作用
物理内存不能隔离进程，地址容易被覆盖，造成程序崩溃  
虚拟地址会通过CPU芯片中的内存管理单元(MMU)的映射关系来转换变成物理地址
分类
- 内核空间
- 用户空间
分配方式
- 分段
  虚拟地址  段选择因子和段内偏移量(段表)
  优点
  - 便于管理
  缺点
  - 内存碎片
  - 内存交换的效率低
- 分页
  虚拟地址  页号和页内偏移量(页表)
  缺点
  - 页表过大
  解决
  - 多级页表
  - 页表缓存
- 段页式

页面置换算法
- 最佳页面置换算法
  置换在未来最长时间不访问的页面
- 先进先出置换算法
  选择在内存驻留时间最长的页面进行中置换
- 最近最久未使用的置换算法
  选择最长时间没有被访问的页面进行置换  
- 最不常用算法
  选择访问次数最少的那个页面进行置换
- 时钟页面置换算法
  把所有的页面都保存在一个类似钟面的环形链表中，一个表针指向最老的页面  
  当发生缺页中断时，算法首先检查表针指向的页面
  如果它的访问位是0就淘汰该页面，并把新的页面插入这个位置，然后把表针前移一个位置
  如果访问位是1就清除访问位，并把表针前移一个位置，重复这个过程直到找到了一个访问位为0的页面为止
```

## 多任务 ##
```
进程
概念
进程是系统进行资源分配的基本单位
状态
- 创建状态
- 就绪状态
- 就绪挂起
- 运行状态
- 阻塞状态
- 阻塞挂起
- 结束状态
控制
- 创建进程
- 终止进程
- 阻塞进程
- 唤醒进程
上下文切换
- 地址空间资源
- 内核栈切换
- 硬件上下文切换

进程间通信 
- 管道
  主要用于同步处理，即管道的两端必须要有一个进程在写入数据，另一个进程在读取数据
  管道可以分为pipe(无名管道)和fifo(命名管道)两种  
  管道的实质是一个内核缓冲区，进程以先进先出的方式从缓冲区存取数据  
  管道是一种半双工的通信方式，数据只能在一个方向上流动
  - 无名管道
    只能在具有亲缘关系的进程间使用。进程的亲缘关系通常是指父子进程关系
  - 命名管道
    任何进程有相应的权限都可以对它进行访问
- 消息队列
  异步，支持多个生产者和多个消费者
  是一系列保存在内核中消息的列表
- 共享内存
  共享内存允许两个或多个进程共享一个给定的存储区，这一段存储区可以被两个或两个以上的进程映射至自身的地址空间中
- 信号
- 信号量
  主要作为进程之间及同一种进程的不同线程之间的同步和互斥手段，它常作为一种锁机制
- SOCKET

调度算法
- 先来先服务调度算法
  每次从就绪队列选择最先进入队列的进程，然后一直运行，直到进程退出或被阻塞，才会继续从队列中选择第一个进程接着运行
- 最短作业优先调度算法
  优先选择运行时间最短的进程来运行
- 时间片轮转调度算法
  每个进程被分配一个时间段，称为时间片，即允许该进程在该时间段中运行
- 高响应比优先调度算法
  每次进行进程调度时，先计算响应比优先级，然后把响应比优先级最高的进程投入运行
- 最高优先级调度算法
  从就绪队列中选择最高优先级的进程进行运行
- 多级反馈队列调度算法
  - 多级  表示有多个队列，每个队列优先级从高到低，同时优先级越高时间片越短
  - 反馈  表示如果有新的进程加入优先级高的队列时，立刻停止当前正在运行的进程，转而去运行优先级高的队列

线程
线程是CPU调度的基本单位

锁
死锁
由于系统中存在一些不可剥夺资源，而当两个或两个以上进程占有自身资源，并请求对方资源时，会导致每个进程都无法向前推进，这就是死锁
死锁产生的必要条件
- 互斥条件  在一段时间内某资源仅为一进程所占用
- 请求和保持条件  当进程因请求资源而阻塞时，对已获得的资源保持不放
- 不剥夺条件  进程已获得的资源在未使用完之前，不能剥夺，只能在使用完时由自己释放
- 循环等待条件  存在一个封闭的进程链，使得每个进程至少占有此链中下一个进程所需要的一个资源
解决死锁的基本方法
- 预防死锁
- 避免死锁
- 检测死锁
- 解除死锁
分类
- 读写锁
- 互斥锁
- 自旋锁
  如果进线程无法取得锁，进线程不会立刻放弃CPU时间片，而是一直循环尝试获取锁，直到获取为止
```

## 网络 ##
```
基础命令
- `ifconfig`  查看网络配置
- `netstat`  查看socket信息
- `ping`  查看连通性和延时

零拷贝
- read+write 
  四次上下文切换，四次数据拷贝
- mmap+write
  四次上下文切换，三次数据拷贝
- sendfile
  两次上下文切换，三次数据拷贝
- sendfile+SG-DMA
  两次上下文切换，两次数据拷贝

文件传输
- 大文件  异步I/O+直接I/O
  绕开PageCache的I/O叫直接I/O，使用PageCache的I/O则叫缓存I/
- 小文件  零拷贝

select&poll&epoll
- select
select实现多路复用的方式是，将已连接的Socket都放到一个文件描述符集合，然后调用select函数将文件描述符集合拷贝到内核里，让内核来检查是否有网络事件产生，检查的方式很粗暴，就是通过遍历文件描述符集合的方式，当检查到有事件产生后，将此Socket标记为可读或可写，接着再把整个文件描述符集合拷贝回用户态里，然后用户态还需要再通过遍历的方法找到可读或可写的Socket，然后再对其处理。
所以，对于select这种方式，需要进行2次「遍历」文件描述符集合，一次是在内核态里，一个次是在用户态里 ，而且还会发生2次「拷贝」文件描述符集合，先从用户空间传入内核空间，由内核修改后，再传出到用户空间中
select使用固定长度的BitsMap，表示文件描述符集合，而且所支持的文件描述符的个数是有限制的
- epoll
poll不再用BitsMap来存储所关注的文件描述符，取而代之用动态数组，以链表形式来组织，突破了select的文件描述符个数限制
- epoll
在内核里使用红黑树来跟踪进程所有待检测的文件描述字
使用事件驱动的机制，内核里维护了一个链表来记录就绪事件
```

# 应用 #