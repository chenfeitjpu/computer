**操作系统（*
- [简介](#简介)
- [概念](#概念)
- [内存](#内存)
- [多任务](#多任务)
- [网络](#网络)
- [常用命令](#常用命令)

## 简介
操作系统是管理计算机硬件与软件资源的程序

## 概念
```
并发&并行
- 并发(concurrency)  在同一时间段内，多个任务轮流使用同一资源
- 并行(parallelism)  在同一时刻，多个任务同时使用不同资源

同步&异步
关心的是程序是否能继续执行
- 同步(synchronous)  当一个操作请求发出后，调用者一直等待返回结果，才能进行后续的执行
- 异步(asynchronous)  当一个操作请求发出后，调用者不用等待返回结果，继续后续的执行。操作处理完成后，通过状态、通知和回调来通知调用者

阻塞&非阻塞
关心的是当前线程是否被操作系统挂起
- 阻塞  线程发起一个操作后，如果结果还没准备好，它就原地等着，啥也不干，这段时间，这个线程是停住的
- 非阻塞  线程发起一个操作后，如果结果还没准备好，系统立刻告诉它：现在没有，它马上继续往下干别的事，这段时间，这个线程一直在跑

内核态&用户态
CPU通过权限等级，限制特权指令的执行
- 内核态  可以执行特权指令
- 用户态  只能执行普通指令
- 状态切换
  - 系统调用
  - 中断
  - 异常

CPU使用率&CPU负载
- CPU使用率  CPU的运行时间
- CPU负载  真正执行或者等待的进程数
```

## 内存
```
虚拟内存

写时复制
```

## 多任务
```
进程
- 定义
  资源分配的最小单位
- 切换
  - 虚拟地址空间切换
  - TLB全部失效
 
线程
- 定义
  cpu调度的最小单位
- 切换
  - 用户态/内核态切换
  - 保存完整CPU寄存器

协程
- 切换
  - 保存少量寄存器
```

## 网络
```
IO多路复用
一个线程同时监听多个IO，当其中任何一个就绪时，才去真正进行读写
- select
  将已连接的Socket都放到一个文件描述符集合，然后调用select函数将文件描述符集合拷贝到内核里，让内核来检查是否有网络事件产生，检查的方式很粗暴，就是通过遍历文件描述符集合的方式，当检查到有事件产生后，将此Socket标记为可读或可写，接着再把整个文件描述符集合拷贝回用户态里，然后用户态还需要再通过遍历的方法找到可读或可写的Socket，然后再对其处理。
  对于select这种方式，需要进行2次「遍历」文件描述符集合，一次是在内核态里，一个次是在用户态里 ，而且还会发生2次「拷贝」文件描述符集合，先从用户空间传入内核空间，由内核修改后，再传出到用户空间中
  select使用固定长度的BitsMap(1024)，表示文件描述符集合，而且所支持的文件描述符的个数是有限制的
- poll
  poll不再用BitsMap来存储所关注的文件描述符，取而代之用动态数组，突破了select的文件描述符个数限制
- epoll
  在内核里使用红黑树来跟踪进程所有待检测的文件描述符
  使用事件驱动的机制，内核里维护了一个链表来记录就绪事件，当用户调用epoll_wait()函数时，只会返回有事件发生的文件描述符

文件传输
- read+write
  - read
    - 用户态切到内核态
    - 通过DMA把文件从磁盘拷贝到内核缓冲区
    - 通过CPU把文件从内核缓冲区拷贝到用户缓冲区
    - 内核态切换到用户态
  - write
    - 用户态切换到内核态
    - 通过CPU把文件从用户缓冲区拷贝到socket缓冲区
    - 通过DMA把文件从socket缓冲区拷贝到网卡
    - 内核态切换到用户态
    四次上下文切换，四次数据拷贝(DMA两次，CPU两次)
- mmap+write
  mmap系统调用函数会直接把内核缓冲区里的数据映射到用户空间
  - mmap
    - 用户态切到内核态
    - 通过DMA把文件从磁盘拷贝到内核缓冲区
    - 内核态切换到用户态
  - write
    - 用户态切换到内核态
    - 通过CPU把文件从内涵缓冲区拷贝到socket缓冲区
    - 通过DMA把文件从socket缓冲区拷贝到网卡
    - 内核态切换到用户态
  四次上下文切换，三次数据拷贝(DMA两次，CPU一次)
- sendfile
  - 实现 sendfile系统调用，可以直接把内核缓冲区里的数据拷贝到socket缓冲区里
  - sendfile
    - 用户态切到内核态
    - 通过DMA把文件从磁盘拷贝到内核缓冲区
    - 通过CPU把文件从内核缓冲区拷贝到socket缓冲区
    - 通过DMA把文件从socket缓冲区拷贝到网卡
    - 内核态切换到用户态
  两次上下文切换，三次数据拷贝(DMA两次，CPU一次)
- sendfile+SG-DMA
  - 实现  把内核缓冲区数据描述符和数据长度传到socket缓冲区，网卡的SG-DMA控制器就可以直接将内核缓存中的数据拷贝到网卡的缓冲区里
  - sendfile
    - 用户态切到内核态
    - 通过DMA把文件从磁盘拷贝到内核缓冲区
    - CPU将内核缓冲区描述符挂到socket缓冲区
    - 通过SG-DMA把文件从内核缓冲区拷贝到网卡
    - 内核态切换到用户态
  两次上下文切换，两次数据拷贝(DMA)
```

## 常用命令
```
快捷键
- `ctrl z`  暂停当前命令
- `ctrl c`  终止当前命令
- `fg`  继续前台执行
- `bg`  继续后台执行
- `ctrl l`  清屏
- `ctrl a`  跳转到输入首部
- `ctrl e`  跳转到输入尾部

关机&重启
- `shutdown -h time`  关机
- `shutdown -r time`  重启
- `reboot`  重启

目录
- `cd path`  切换
  cd ~|cd -
- `ls path`  查看
  ls | la -a | ls -l
- `mkdir`  创建目录
  mkdir -p 
- `rm -rf`  删除目录
- `rmdir`  删除空目录
  rmdir -p  
- `mv`  剪切目录
- `cp`  拷贝目录
- `find directory option pattern command`  文件查找
- `touch file file`  创建文件
- `rm file`  删除文件
- `vim file`  修改文件
- `cat file`  查看文件 
- `tac file`  查看文件
- `head option pattern file file`  查看文件开头部分
- `tail option pattern file file`  查看文件结尾部分
- `chmod [u|g|o|a] [+|-|=] [r|w|x] directory|file`
- `tar -zcvf *.tar.gz directory|file`  打包文件
- `tar -zxvf *.tar.gz -C directory`  解包文件

查找
- `grep option pattern file`  文本搜索工具，它能使用正则表达式搜索文本，并把匹配的行打印出来
  -A x  除了显示符合样式的那一列之外，并显示该行之后的x行内容
  -B x  除了显示符合样式的那一行之外，并显示该行之前的x行内容
  -C x  除了显示符合样式的那一行之外，并显示该行之前后的x行内容
  -c  统计匹配的行数
  -e  实现多个选项间的逻辑or关系
  -E  扩展的正则表达式
  -f file  从文件获取PATTERN匹配
  -F  相当于fgrep，PATTERN被当作固定字符串
  -i  忽略字符大小写的差别
  -n  显示匹配的行号
  -o  仅显示匹配到的字符串
  -q  静默模式，不输出任何信息
  -s  不显示错误信息。
  -v  显示不被pattern匹配到的行，相当于[^]反向匹配
  -w  匹配整个单词  
- `sed [-hnV][-e<script>][-f<script文件>] file`  利用脚本来处理文本文件
  -e<script>  以选项中指定的script来处理输入的文本文件，这个-e可以省略，直接写表达式
  -f<script文件>  以选项中指定的script文件来处理输入的文本文件
  -h  显示帮助
  -n  仅显示script处理后的结果
  -V  显示版本信息
  i  插入  i的后面可以接字串，而这些字串会在新的一行出现(目前的上一行)
  a  新增  a的后面可以接字串，而这些字串会在新的一行出现(目前的下一行)
  d  删除  因为是删除啊，所以d后面通常不接任何东西
  c  取代  c的后面可以接字串，这些字串可以取代n1,n2之间的行
  s  取代  替换单个字符，通常这个s的动作可以搭配正规表示法，例如1,20s/old/new/g
  p  打印  将某个选择的数据印出，通常p会与参数sed -n一起运行
- `awk option [<script>] [-f<scriptfile>] var=value file`  文本分析
  option
    -F fs  fs指定输入文件折分隔符，fs是一个字符串或者是一个正则表达式，默认是空格或者tab键
  变量
    FILENAM  当前文件名
    FS  字段分隔符，默认是空格和制表符
    RS  行分隔符，用于分割每一行，默认是换行符
    OFS  输出字段的分隔符，用于打印时分隔字段，默认为空格
    ORS  输出记录的分隔符，用于打印时分隔记录，默认为换行符
    NF  总字段数量
    NR  当前行
  函数
    toupper()  字符转为大写
    tolower()  字符转为小写
    length()  返回字符串长度
    substr()  返回子字符串

排序
- `sort option` 
  -n 按数字进行排序 
  -d 按字典序进行排序
  -r 逆序排序
  -k N 指定按第N列排序

去重
- `uniq`
  -c  统计各行在文件中出现的次数
  -d  找出重复行

统计
- `wc`
  -l  统计行数
  -w  统计单词数
  -c  统计字符数

命令行参数转换
- `xargs options command`
  -d  定义定界符(默认为空格 多行的定界符为n)
  -L  从标准输入一次读取num行送给command命令
  -n  表示命令在执行的时候一次用的argument的个数，默认是用所有的
  -I  将xargs的每项名称赋值给{}，可以用{}代替

其它
- `ssh username@ip`  远程登录
- `ping domain|ip`  网络检测
- `wget url`  文件下载
- `su -username`  切换用户
- `netstat -tln | grep port`  查看端口使用情况
- `lsof -i :port`  查看端口属于程序
```

学习资料  
[文件随机或顺序读写原理深入浅出](https://www.cnblogs.com/liuche/p/15455808.html)