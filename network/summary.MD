**计算机网络**
- [定义](#定义)
- [内容](#内容)

# 定义 #
在不同设备间进行通信

# 内容 #
```
网络分层  
- 应用层  
  实现应用间通信(message)
- 传输层  
  实现进程间通信(segment)
- 网络层  
  实现网络间通信(packet)
- 数据链路层  
  实现设备间通信(frame)
- 物理层  
  发送、接收、传输电信号

请求发送过程
- 构造请求数据  
- DNS查询，获取IP地址  
- 生成TCP数据包  
- 生成IP数据包  
- ARP解析，获取MAC地址    
- 生成MAC数据包  
- 网卡发送数据  
- 交换机进行转发  
- 路由器进行路由

请求接收过程
- 网卡接收数据
- 解析MAC数据包
- 解析IP数据包
- 解析TCP数据包
- 把数据发送给应用
- 应用读取数据

linux发送网络包
- 将用户态待发送的数据拷贝到内核态sk_buff，并将其加入到socket发送缓冲区
- 网络协议栈从socket发送缓冲区中取出sk_buff，并按照TCP/IP协议栈从上到下逐层处理
- 如果使用的是TCP传输协议发送数据，那么先拷贝一个新的sk_buff副本
- 填充TCP头
- 填充IP头
- 填充帧头和帧尾，将sk_buff放到网卡的发送队列中
- 触发软中断告诉网卡驱动程序，这里有新的网络包需要发送
- 驱动程序将sk_buff数据映射到网卡可访问的内存DMA区域，最后触发真实的发送
- 发送完成的时候，网卡设备会触发一个硬中断来释放内存，主要是释放sk_buff内存和清理RingBuffer内存

linux接收网络包
- 当网卡接收到一个网络包后，会通过DMA技术，将网络包写入到指定的内存地址，也就是写入到Ring Buffer 
- 网卡向CPU发起硬件中断，当CPU收到硬件中断请求后，发起一个软中断
- 内核线程会从Ring Buffer中获取一个数据帧，用sk_buff表示，从而可以作为一个网络包交给网络协议栈进行逐层处理
- 去掉帧头和帧尾
- 去掉IP头
- 去掉TCP头或UDP头
- 把数据放到socket的接收缓冲区
- 应用层程序调用Socket接口将内核的socket接收缓冲区的数据拷贝到应用层的缓冲区，然后唤醒用户进程
```
