**计算机网络**
- [定义](#定义)
- [内容](#内容)

# 定义 #
在不同设备间进行通信

# 内容 #
```
网络分层  
- 应用层  实现应用间通信(message)
- 运输层  实现进程间通信(segment)
- 网络层  实现网络间通信(packet)
- 链路层  实现设备间通信(frame)
- 物理层  发送、接收、传输电信号

请求解析过程
- 解析请求，生成请求消息  
- DNS查询，找到IP地址  
- 生成TCP数据包  
- 生成IP数据包  
- ARP解析，获取MAC地址    
- 生成MAC数据包  
- 网卡驱动发送数据  
- 交换机进行转发  
- 路由器进行路由

linux发送网络包
- 将用户态待发送的数据拷贝到内核态sk_buff，并将其加入到发送缓冲区
- 网络协议栈从Socket发送缓冲区中取出sk_buff，并按照TCP/IP协议栈从上到下逐层处理
- 如果使用的是TCP传输协议发送数据，那么先拷贝一个新的sk_buff副本
- 填充TCP头
- 填充IP头
- 填充帧头和帧尾，将sk_buff放到网卡的发送队列中
- 触发「软中断」告诉网卡驱动程序，这里有新的网络包需要发送
- 驱动程序将将sk_buff数据映射到网卡可访问的内存DMA区域，最后触发真实的发送
- 发送完成的时候，网卡设备会触发一个硬中断来释放内存，主要是释放sk_buff内存和清理RingBuffer内存

linux接受网络包
1.当网卡接收到一个网络包后，会通过DMA技术，将网络包写入到指定的内存地址，也就是写入到Ring Buffer 
2.网卡向CPU发起硬件中断，当CPU收到硬件中断请求后，根据中断表，调用已经注册的中断处理函数
3.硬件中断处理函数会先「暂时屏蔽中断」，接着，发起「软中断」，然后恢复刚才屏蔽的中断
4.内核中的ksoftirqd线程专门负责软中断的处理，当ksoftirqd内核线程收到软中断后，就会来轮询处理数据
5.ksoftirqd线程会从Ring Buffer中获取一个数据帧，用sk_buff表示，从而可以作为一个网络包交给网络协议栈进行逐层处理
6.去掉帧头和帧尾
7.去掉IP头
8.去掉TCP头或UDP头
9.把数据放到Socket的接收缓冲区
10.将内核的Socket接收缓冲区的数据「拷贝」到应用层的缓冲区，然后唤醒用户进程
```